<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Terminal</title>
    <style>
        body { font-family: monospace; display: flex; flex-direction: column; align-items: center; }
        #editor { width: 80%; height: 300px; margin: 10px; }
        #terminal { 
            width: 80%; 
            height: 300px; 
            background-color: black; 
            color: green; 
            padding: 10px; 
            overflow-y: scroll; 
            font-family: monospace;
        }
    </style>
</head>
<body>
<h2>JavaScript Terminal</h2>

<div id="editor"></div>
<button id="runButton">Run Code</button>
<div id="terminal"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Initialize Ace editor
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");

    const terminal = document.getElementById('terminal');

    // Custom IO system
    const IO = {
        output: function(message) {
            const outputLine = document.createElement('div');
            outputLine.textContent = typeof message === 'object' 
                ? JSON.stringify(message, null, 2) 
                : String(message);
            terminal.appendChild(outputLine);
            terminal.scrollTop = terminal.scrollHeight;
        },
        input: function() {
            return new Promise((resolve) => {
                const inputLine = document.createElement('div');
                inputLine.innerHTML = '> <input type="text" class="io-input">';
                terminal.appendChild(inputLine);
                terminal.scrollTop = terminal.scrollHeight;

                const inputEl = inputLine.querySelector('.io-input');
                inputEl.focus();

                inputEl.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const value = this.value;
                        this.disabled = true;
                        resolve(value);
                        
                        const outputLine = document.createElement('div');
                        outputLine.textContent = value;
                        terminal.appendChild(outputLine);
                        terminal.scrollTop = terminal.scrollHeight;
                    }
                });
            });
        }
    };

    // Override console.log
    console.log = IO.output;

    document.getElementById('runButton').addEventListener('click', async () => {
        // Clear terminal
        terminal.innerHTML = '';

        try {
            // Get the JavaScript code from the editor
            const jsCode = editor.getValue();

            // Use AsyncFunction to support async/await
            const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;
            const runnable = new AsyncFunction('IO', jsCode);
            
            // Run the code with our custom IO
            await runnable(IO);
        } catch (error) {
            IO.output('Error: ' + error.message);
        }
    });
});
</script>
</body>
</html>
