<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Translator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-python.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-rust.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        #languageSelector {
            margin-bottom: 15px;
            padding: 5px;
        }
        #editor {
            width: 100%;
            height: 300px;
            margin: 10px 0;
            border: 1px solid #ccc;
        }
        #output {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            background-color: #f0f0f0;
            overflow: auto;
            padding: 10px;
            white-space: pre-wrap;
        }
        #terminal {
            width: 100%;
            height: 300px;
            background-color: black;
            color: green;
            padding: 10px;
            overflow-y: scroll;
            font-family: monospace;
        }
        button {
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
<h2>Code Translator</h2>

<select id="languageSelector">
    <option value="python">Python</option>
    <option value="rust">Rust</option>
</select>

<div id="editor"></div>

<button id="translateButton">Translate to JavaScript</button>
<button id="runButton" disabled>Run JavaScript Code</button>

<div id="output">Translated code will appear here</div>
<div id="terminal"></div>

<script type="module">
    import PythonTranspiler from './PythonTranspiler.js';

    // Initialize Ace editor
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");

    // Language selector
    const languageSelector = document.getElementById('languageSelector');
    const translateButton = document.getElementById('translateButton');
    const runButton = document.getElementById('runButton');
    const outputDiv = document.getElementById('output');
    const terminal = document.getElementById('terminal');

    // Create PythonTranspiler instance
    const pythonTranspiler = new PythonTranspiler();

    // Set initial mode to Python
    editor.session.setMode("ace/mode/python");

    // Update editor mode on language change
    languageSelector.addEventListener('change', (e) => {
        const selectedLanguage = e.target.value;

        // Update editor mode
        switch(selectedLanguage) {
            case 'python':
                editor.session.setMode("ace/mode/python");
                break;
            case 'rust':
                editor.session.setMode("ace/mode/rust");
                break;
        }

        // Clear previous content
        editor.setValue('');
        outputDiv.textContent = 'Translated code will appear here';
        terminal.innerHTML = '';
        runButton.disabled = true;
    });

    // Translation function using PythonTranspiler
    function translateCode(code, language) {
        if (language === 'python') {
            // Use the PythonTranspiler for Python
            return pythonTranspiler.translatePython(code);
        } else {
            // Fallback for other languages (mock implementation)
            return {
                success: true,
                code: `// Translated ${language} code\nconsole.log("Hello, World!");`
            };
        }
    }

    // Translation button click handler
    translateButton.addEventListener('click', () => {
        const sourceCode = editor.getValue();
        const sourceLanguage = languageSelector.value;

        // Clear previous output
        outputDiv.textContent = '';
        terminal.innerHTML = '';

        // Perform translation
        const result = translateCode(sourceCode, sourceLanguage);

        if (result.success) {
            outputDiv.textContent = result.code;
            runButton.disabled = false;
        } else {
            outputDiv.textContent = result.errors ? result.errors.join('\n') : 'Translation failed';
        }
    });

    // Run button click handler
    runButton.addEventListener('click', () => {
        terminal.innerHTML = ''; // Clear terminal
        try {
            // Create a function from the translated code
            const runCode = new Function(outputDiv.textContent);
            // Capture console output
            const originalLog = console.log;
            console.log = (msg) => {
                const line = document.createElement('div');
                line.textContent = msg;
                terminal.appendChild(line);
            };

            // Run the code
            runCode();

            // Restore original console.log
            console.log = originalLog;
        } catch (error) {
            const errorLine = document.createElement('div');
            errorLine.textContent = `Error: ${error.message}`;
            errorLine.style.color = 'red';
            terminal.appendChild(errorLine);
        }
    });
</script>
</body>
</html>
